(window["_sbz_4_jsonp_1736b7a65d7"]=window["_sbz_4_jsonp_1736b7a65d7"]||[]).push([["widget"],{"2fb5":function(e,t,i){e.exports=i.p+"img/subiz-mono.0828dc90.svg"},"61a2":function(e,t){
/**
 * @fileoverview dragscroll - scroll area by dragging
 * @version 0.0.8
 *
 * @license MIT, see http://github.com/asvd/dragscroll
 * @copyright 2015 asvd <heliosframework@gmail.com>
 */
function i(e){var t,i;e.removeEventListener("mousedown",e.md,0),window.removeEventListener("mouseup",e.mu,0),window.removeEventListener("mousemove",e.mm,0),e.md=function(s){e.hasAttribute("nochilddrag")&&document.elementFromPoint(s.pageX,s.pageY)||(i=1,t=s.clientX,s.preventDefault())},e.mu=()=>{i=0},e.mm=function(s){i&&(e.scrollLeft-=-t+s.clientX,t=s.clientX)},e.addEventListener("mousedown",e.md,0),window.addEventListener("mouseup",e.mu,0),window.addEventListener("mousemove",e.mm,0)}e.exports=i},"78f8":function(e,t,i){e.exports=i.p+"img/send.c4dc0cd3.svg"},9487:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAABMBAMAAAD5IHbzAAAALVBMVEUAAACAgIDOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9LOz9Jx/4FfAAAADnRSTlMAABEiM2Z3iJmqu8zd7nNoFvUAAAFZSURBVEjH7dZNSsNAFMDx1wriQkqHUsRduujKjUs3Qi5iwI0bIXgAEcEjCC49xBygiEsXPUMRLYUJOYPJZNLMRybzHqiredv01/9iJuQBxIkzOBfrcmiKJzY1fn9YhubaBHkQbA1wUIbnXAdHCPCog2MEeNPBBAE2vwB26Wi5JoAihRE7IYB3qADL8SCV4BQNdiDBDA2+GsBesWCjQP6vQNwOgE8FHjTAxys/+FZAO2uRwJkfFA2Y6wGALuEe3J0El0YAuoQLtjWYrYyAlui5rc8VuLICXaLvfXi5uS+tQJcIvkAqsE8EAW8fqkQI7ANtwgM+nECb6AdikTkBlegHvD1prj8ee4FYMJY5AQAv4ExdJg4oUAdkwgp4Aa+vd52wAj4gEglYZgd8gEMD5nyKAtX/NoAxHOBABAkVQAS42/rXn10CIK8O5OWEvP6QFyz6CkdeEuPEsecHKyj55VqBGH0AAAAASUVORK5CYII="},"9ffa":function(e,t,i){e.exports=i.p+"img/rating--great.f6aa750a.svg"},bc27:function(e,t,i){e.exports=i.p+"img/rating--poor.c4035a06.svg"},c94d:function(e,t,i){e.exports=i.p+"img/rating--average.5fc94010.svg"},de35:function(e,t,i){"use strict";i.r(t);var s=i("07a4"),r=i("2fb5"),a={name:"PoweredBy",render(){const e=arguments[0];let t=e("img",{class:"poweredby--subiz-logo",attrs:{src:r,alt:!0}});var i=`https://subiz.com/?utm_source=id-${s["a"].user.account_id}&utm_medium=widget&utm_campaign=widget_referral`;return e("div",{class:"poweredby"},[e("a",{attrs:{href:i,target:"_blank"},class:"poweredby--text"},[this.$t("powered_by")," ",t," Subiz"])])}};function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function n(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l=i("4260"),d={name:"AgentsAvatar",props:["mode","tooltipPos","agent_ids","border"],data(){return n({},s["a"].bind(this,["accountSetting"]))},render(){const e=arguments[0];var t=l.map(this.agent_ids,e=>s["a"].agentM[e]);if(void 0===this.agent_ids||0===l.size(this.agent_ids)){var r=l.get(this.accountSetting,"header.agent_ids",[]);r=l.filter(r,e=>!!s["a"].agentM[e]),t=0!==r.length?l.map(r,e=>s["a"].agentM[e]):l.filter(s["a"].agentM,e=>"agent"===e.type)}t=l.filter(t,e=>!!e);var a=this.tooltipPos||"bottom",o=this.mode||"primary";if(0===t.length)return e("div",{class:"group-avatar group-avatar--"+o},[e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":l.get(s["a"].account,"name"),"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-left",attrs:{src:l.replaceFileUrl(l.get(s["a"].account,"logo_url"))||i("9487")}})])]);if(1===t.length){var n=t[0],c="primary"===o?"group-avatar--agent-middle":"group-avatar--agent-left";return e("div",{class:"group-avatar group-avatar--"+o},[e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":n.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar "+c,attrs:{src:l.replaceFileUrl(n.avatar_url)||i("b55b")}})])])}if(2===t.length){let r=t[0],n=t[1];return e("div",{class:"group-avatar group-avatar--"+o},[e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":r.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-left",attrs:{src:l.replaceFileUrl(r.avatar_url)||i("b55b")}})]),e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":n.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-right",attrs:{src:l.replaceFileUrl(n.avatar_url)||i("b55b")}})])])}let d=t[0],m=t[1],u=t[2];return e("div",{class:"group-avatar group-avatar--"+o},[e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":d.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-left",attrs:{src:l.replaceFileUrl(d.avatar_url)||i("b55b")}})]),e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":m.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-middle",attrs:{src:l.replaceFileUrl(m.avatar_url)||i("b55b")}})]),e("div",{class:"d-inline-block pos-relative",attrs:{"data-tooltip":u.fullname||s["a"].account.name,"data-tooltip-position":a}},[e("img",{class:"avatar group-avatar--agent-right",attrs:{src:l.replaceFileUrl(u.avatar_url)||i("b55b")}})])])}},m=i("4260"),u=new m.Pubsub;setInterval(()=>{u.publish("time")},2e4);var h={name:"Time",props:["ago","uppercase","time","tzoffset"],data(){return{t:"",timeSub:"",langCode:"en_US"}},methods:{updateTime(){var e="";e=this.ago?this.time>0?m.agoTime(this.time,this.langCode):"":m.shortTime(this.time,this.tzoffset),this.uppercase&&(e=e.toUpperCase()),e!==this.t&&(this.t=e)}},mounted(){this.langCode=s["a"].i18n.locale,this.timesub=u.on("time",()=>this.updateTime()),this.updateTime()},destroyed(){u.un(this.timesub)},render(){const e=arguments[0];return e("span",[this.t])}},v=i("903e");function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function g(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){f(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var y=i("4260"),b={name:"Header",props:["convoKey","mode","hideBackButton","agentsJoined"],data(){return g({openMenu:!1},s["a"].bind(this,["convoM","convoEventM","account","accountSetting","user"]))},render(){return"collapsed"===this.mode?this.renderCollapsedHeader():this.renderExpandedHeader()},methods:{renderExpandedHeader(){let e=y.get(this.accountSetting,"header.layout");return"social"==e?this.renderSocial():this.renderTeam()},renderCollapsedHeader(){const e=this.$createElement;let t=y.map(this.agentsJoined,e=>e.id);return e("div",{class:"widget-header widget-header--collapsed"},[this.renderBackButton(),e(d,{attrs:{mode:"secondary",agent_ids:t}}),e("div",{class:"widget-header--title-container"},[e("div",{class:"widget-header--title"},[this.getTitle()]),e("div",{class:"pos-relative"},[e("div",{class:"widget-header--description",attrs:{"data-tooltip":this.getDesc()}},[this.getDesc()])])]),this.renderMoreButton(),this.renderCloseButton()])},renderSocial(){const e=this.$createElement;let t=y.get(this.accountSetting,"header.links")||[],i=y.map(t,t=>t.url&&t.type&&"subiz"!==t.type?"email"===t.type?e("div",[e("a",{attrs:{href:"mailto:"+t.url,title:t.url}},[e("i",{class:"social__links-logo social__links-logo--"+t.type})])]):e("div",[e("a",{attrs:{href:t.url,target:"_blank",title:t.url}},[e("i",{class:"social__links-logo social__links-logo--"+t.type})])]):null);const s="Chúng tôi sẵn sàng trợ giúp :wave:.\nVui lòng hỏi chúng tôi bất cứ điều gì hoặc chia sẻ phản hồi của bạn";var r=y.get(this,"accountSetting.introduction")||this.$t("team_intro")||s,a=y.extractText(r).map(t=>"emoji"===t.type?e(v["a"],{attrs:{emojiCode:t.text}}):t.text);return e("div",[e("div",{class:"widget-header--top-wrapper"},[this.renderBackButton(),e("div",{class:"widget-header--title"},[this.getTitle()]),this.renderCloseButton()]),e("div",{class:"social"},[e("div",[e("img",{class:"social__account-logo",attrs:{src:y.replaceFileUrl(y.get(this.account,"logo_url"))}})]),e("div",{class:"social__right"},[e("div",{class:"social__introduction"},[a]),e("div",{class:"social__links"},[i])])])])},renderTeam(){const e=this.$createElement,t="Chúng tôi sẵn sàng trợ giúp :wave:.\nVui lòng hỏi chúng tôi bất cứ điều gì hoặc chia sẻ phản hồi của bạn";var i=y.get(this,"accountSetting.introduction")||this.$t("team_intro")||t,s=y.extractText(i).map(t=>"emoji"===t.type?e(v["a"],{attrs:{emojiCode:t.text}}):t.text);return e("div",[e("div",{class:"widget-header--top-wrapper"},[this.renderBackButton(),e("div",{class:"widget-header--title"},[this.getTitle()]),this.renderCloseButton()]),e("div",{class:"widget-header--avatar-wrapper"},[e(d,{attrs:{mode:"primary"}})]),e("div",{class:"widget-header--title-container"},[e("div",{class:"pos-relative"},[e("div",{class:"widget-header--description"},[s])])])])},getJoinedNameMember(e){return y.map(e,e=>e.name).join(", ")},getTitle(){return this.getJoinedNameMember(this.agentsJoined)||y.get(this,"accountSetting.title")||y.get(this,"account.name")||this.$t("widget_title")},getDesc(){let e=y.get(s["a"].accountSetting,"is_online")?this.$t("agent_online"):this.$t("agent_offline");return y.get(this,"accountSetting.introduction")||e},renderMoreButton(){this.$createElement;return null},renderBackButton(){const e=this.$createElement;if(this.hideBackButton)return null;if(0===y.size(this.convoM))return null;var t=null,i=y.size(y.filter(this.convoEventM,(e,t)=>!y.isConvoSeen(this.user.id,e)&&t!==this.convoKey));return 0!==i&&(t=e("span",{class:"widget-header--total-unread-convo"},[i])),e("div",{class:"widget-header--wrap-button-back "+(i?"widget-header--has-convo-unred":""),on:{click:e=>(e.stopPropagation(),e.preventDefault(),this.onBackClick(e))}},[e("div",{class:"widget-header--button-back",attrs:{"data-tooltip":this.$t("menu_back")}}),t])},renderCloseButton(){const e=this.$createElement;return e("div",{class:"widget-header--button widget-header--button-close",attrs:{"data-tooltip":this.$t("close"),"data-tooltip-position":"bottom"},on:{click:e=>(e.stopPropagation(),e.preventDefault(),this.onCloseClick(e))}},[e("span",{class:"widget-header--button-close-icon"})])},renderMenu(){const e=this.$createElement;var t=this.openMenu?"":"d-none";y.size(this.convoM);return e("div",{class:"dropdown-menu "+t,directives:[{name:"clickaway",value:this.hideMenu}]},[e("div",{class:"dropdown-menu--dropdown-item",on:{click:this.onNotiClick}},[e("div",{class:"widget-header--more-icon widget-header--more-icon--notification"}),e("div",[this.$t("turn_on_notification")])]),e("div",{class:"dropdown-menu--dropdown-item"},[e("div",{class:"widget-header--more-icon widget-header--more-icon--rate"}),e("div",[this.$t("rate_conversation")])])])},async onNotiClick(){},onBackClick(){this.hideMenu(),this.$emit("gotoList")},hideMenu(){this.openMenu=!1},onMoreClick(){this.openMenu=!this.openMenu},onCloseClick(){this.$emit("close")}}};function k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function w(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?k(Object(i),!0).forEach((function(t){O(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function O(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _=i("4260"),j=i("78f8");const P=i("337f").getParser(window.navigator.userAgent).parsedResult;var E={name:"ConvoList",props:["isShow"],data(){return w(w({},s["a"].bind(this,["convoM","convoEventM","user","account","accountSetting"])),{},{defaultAvatar:"https://filev4.subiz.com/fiqoahedjbgwclpouoml-avatar_default_baa8a1d7.png"})},mounted(){s["a"].setLastview("list")},render(){const e=arguments[0];var t=_.map(this.convoM,e=>e);t=_.orderBy(_.cloneDeep(t),"created","desc");var i=_.map(t,t=>{var i=_.agentsOfConvo(t);return e("div",{class:"convo-list--item",key:t._key,on:{click:()=>this.go(t._key)}},[e(d,{attrs:{mode:"member",tooltipPos:"right",agent_ids:i},class:"d-flex flex-row"}),this.renderConvoSummary(t)])});let s="widget-container ",r=_.get(this.accountSetting,"desktop_button.position")||"right";return"mobile"===P.platform.type&&(r=_.get(this.accountSetting,"mobile_button.position")||r),s+=" widget-container--"+r,s+=this.isShow?"":" widget-container--hide",e("div",{class:s},[e("div",{class:"widget-header widget-header--convo-list-expanded"},[e(b,{attrs:{hideBackButton:!0,mode:"expanded"},on:{close:()=>this.$emit("close")}})]),e("div",{class:"convo-list"},[e("div",{class:"convo-list--container"},[e("div",{class:"convo-list--title"},[this.$t("conversations")]),e("div",{class:"convo-list--list"},[i])]),e("div",{class:"convo-list--footer"},[e("button",{class:"btn--start-convo",on:{click:this.onStartConvoClick}},[e("span",[this.$t("start_conversation")]),e("img",{attrs:{src:j,alt:!0}})]),e(a)])])])},methods:{async onStartConvoClick(){await s["a"].fetchUserSetting(),this.go("")},renderConvoSummary(e){const t=this.$createElement;var i=this.agentsOfConvo(e),s=_.each(i,e=>e.fullname).join(", ");s||(s=this.account.name),s||(s=this.$t("agent"));var r=null;"user"===e.lastSenderType&&(r=t("span",{class:"yourmessage"},[this.$t("you"),":"]));var a=new Date(_.getMs(e.last_actived)||_.getMs(e.created)),o=t(h,{attrs:{ago:!0,time:a},key:(new Date).getTime()}),n=this.renderMessagePreview({data:{message:_.get(e,"last_message")}});return t("div",{class:"convo-list--convo-last-info"},[t("div",{class:"d-flex flex-row"},[t("div",{class:"convo-list--convo-name"},[s]),t("div",{class:"convo-list--convo-time"},[o])]),t("div",{class:"d-flex flex-row"},[t("div",{class:"convo-list--convo-last-message"},[r,n]),this.renderUnread(e)])])},renderUnread(e){const t=this.$createElement;let i=_.isConvoSeen(this.user.id,this.convoEventM[e._key]);return i?null:t("div",{class:"convo-list--item-unread"})},go(e){this.$emit("go",e)},agentsOfConvo(e){var t=_.agentsOfConvo(e);return _.map(t,e=>s["a"].agentM[e]||{avatar_url:this.defaultAvatar,fullname:"Offline Agent"})},renderMessagePreview(e){const t=this.$createElement;let i=this.$t("sent_you_a_message"),s=_.get(e,"data.message.text");var r=_.get(e,"data.message.format");if("plaintext"!==r&&(s=i),!s&&_.size(_.get(e,"data.message.attachments"))>0&&(s=i),!s)return null;let a=_.get(e,"by.type");return _.map(_.extractText(s),e=>"emoji"===e.type?t(v["a"],{attrs:{emojiCode:e.text,byType:a}}):e.text)}}},$=i("2638"),D=i.n($),M=i("5a0c"),x=i.n(M);function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function C(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){A(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function A(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var F=i("4260"),I={name:"MessageInput",props:["disabled","convoKey"],data(){return C(C({},s["a"].bind(this,["convoEventM"])),{},{message:"",openEmoji:!1})},mounted(){s["a"].onConvoEvent(this,e=>{var t=F.convoKeyOfEv(e);t===this.convoKey&&this.$forceUpdate()})},render(){const e=arguments[0];var t=e("div",{class:"d-flex flex-row align-self-end"},[this.renderEmoji(),e("div",{attrs:{"data-tooltip-position":"top-left"},class:"message-input--button message-input--attachment-button",on:{click:e=>(e.stopPropagation(),this.selectFile(e))}})]),i=F.trim(this.message);i.length>0&&(t=e("div",{class:"d-flex flex-row align-self-end"},[this.renderEmoji(),e("div",{attrs:{"data-tooltip-position":"top-left"},class:"message-input--button message-input--send-button",on:{click:()=>this.submitMessage()}})]));var s="",r=this.hasUnfinishRequiredForm()||this.disabled;return r&&(s="message-input--disabled"),e("div",{class:"message-input "+s,on:{click:()=>{this.$refs.messageInput.focus()}}},[e("input",{class:"d-none",ref:"fileInput",attrs:{type:"file",multiple:!0},on:{change:this.sendFile}}),e("textarea",D()([{on:{input:e=>{e.target.composing||(this.message=e.target.value)}},attrs:{disabled:r,maxlength:"1024",placeholder:this.$t("message_input_help"),rows:"1","data-emojiable":"true"},class:"message-input--input",ref:"messageInput",domProps:{value:this.message}},{directives:[{name:"model",value:this.message,modifiers:{}}]},{on:{paste:this.pasteImage,keydown:this.onKeydown,keyup:this.onKeyup}}])),t])},methods:{hasUnfinishRequiredForm(){var e,t=F.orderBy(F.map(this.convoEventM[this.convoKey],e=>e),"created","desc");for(let r of t)if("message_sent"===F.get(r,"type")&&"user"!==F.get(r,"by.type")){e=r;break}"user"===F.get(e,"by.type")&&(e=null);let i=F.get(e,"data.message.attachments",[]),s=F.filter(i,e=>{if(!e)return!1;if("form"!==e.type&&"ask_info_form"!==e.type)return!1;var t=e.form;if(!t)return!1;var i=F.parseJSON(t.state)||{};return!(!i.require_finished&&"ask_info_form"!==e.type)&&!t._submitted});return F.size(s)>0},renderEmojiPopup(){const e=this.$createElement;return this.openEmoji?e("div",{class:"emoji-picker",directives:[{name:"clickaway",value:this.hideEmoji}]},[e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":like:"},class:"emoji-picker--item emoji--like",on:{click:()=>this.emojiPick(":like:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":unlike:"},class:"emoji-picker--item emoji--unlike",on:{click:()=>this.emojiPick(":unlike:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":angry:"},class:"emoji-picker--item emoji--angry",on:{click:()=>this.emojiPick(":angry:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":confused:"},class:"emoji-picker--item emoji--confused",on:{click:()=>this.emojiPick(":confused:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":crying:"},class:"emoji-picker--item emoji--crying",on:{click:()=>this.emojiPick(":crying:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":grinning:"},class:"emoji-picker--item emoji--grinning",on:{click:()=>this.emojiPick(":grinning:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":heart-eyes:"},class:"emoji-picker--item emoji--heart-eyes",on:{click:()=>this.emojiPick(":heart-eyes:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":neutral:"},class:"emoji-picker--item emoji--neutral",on:{click:()=>this.emojiPick(":neutral:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":sad:"},class:"emoji-picker--item emoji--sad",on:{click:()=>this.emojiPick(":sad:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":sleepy:"},class:"emoji-picker--item emoji--sleepy",on:{click:()=>this.emojiPick(":sleepy:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":smiling:"},class:"emoji-picker--item emoji--smiling",on:{click:()=>this.emojiPick(":smiling:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":surprised:"},class:"emoji-picker--item emoji--surprised",on:{click:()=>this.emojiPick(":surprised:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":tired:"},class:"emoji-picker--item emoji--tired",on:{click:()=>this.emojiPick(":tired:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":tongue-out:"},class:"emoji-picker--item emoji--tongue-out",on:{click:()=>this.emojiPick(":tongue-out:")}})]),e("div",{class:"emoji-picker-background-item"},[e("div",{attrs:{"data-tooltip":":wink:"},class:"emoji-picker--item emoji--wink",on:{click:()=>this.emojiPick(":wink:")}})])]):null},resizeInput:F.throttle((function(){const e=this.$refs.messageInput;e.style.setProperty("height","1em","important");const t=Math.min(200,e.scrollHeight);e.style.setProperty("height",t+"px","important")}),5),focus(){this.disabled||this.$refs.messageInput&&this.$refs.messageInput.focus()},renderEmoji(){const e=this.$createElement;return e("div",[this.renderEmojiPopup(),e("div",{class:"message-input--button message-input--emoji-button",on:{click:e=>(e.stopPropagation(),this.toggleEmoji(e))}})])},toggleEmoji(){this.focus(),this.disabled||(this.openEmoji=!this.openEmoji)},hideEmoji(){this.openEmoji=!1},emojiPick(e){const t=this.$refs.messageInput,i=t.selectionStart,s=this.message;this.message=[s.slice(0,i),e,s.slice(i)].join(""),this.hideEmoji(),t.focus()},onEnter:F.throttle((function(){this.submitMessage()}),50),onKeyup(e){this.message=e.target.value,13===e.keyCode&&!1===e.shiftKey&&this.onEnter(),this.sendTyping()},onKeydown(e){this.message=e.target.value,this.resizeInput(),13===e.keyCode&&!1===e.shiftKey&&e.preventDefault()},selectFile(){this.disabled||this.$refs.fileInput.click()},sendFile(){const e=this.$refs.fileInput.files;F.log("files:",e),this._sendFile(e)},async _sendFile(e){if(0===F.size(e))return;if(this.disabled)return;const t=await s["a"].uploadToS3(e);this.$refs.fileInput.value="",F.log("upload result:",t);const i=[];for(let s of t){const e={type:"file",mimetype:s.type,url:F.replaceFileUrl(s.url),name:s.name,size:s.size};i.push(e)}this.$emit("send",{attachments:i}),this.$refs.fileInput.value=""},async submitMessage(e){e=e||F.trim(this.message)||"",e&&(this.disabled||(this.message="",this.openEmoji=!1,this.$emit("send",{text:e,format:"plaintext"})))},sendTyping(){if(this.convoKey)return s["a"].typing(this.convoKey)},pasteImage(e){if(F.log("event",e),!window.File||!window.FileReader||!window.FileList||!window.Blob)return void F.log("The File APIs are not fully supported in this browser.");const t="Paste-image-"+x()(new Date).format("YYYY-MM-DD-HH-mm-ss");let i=null;const s=e.clipboardData.items[0];if(0===s.type.indexOf("image")&&(i=s.getAsFile()),!i)return void F.log("paste image: no data");const r=[i,new ArrayBuffer],a=new File(r,t+".png",{type:"image/png"});this._sendFile([a])}}},U=i("4260"),T=i("39c6"),K={name:"ImageAttachment",props:["ev"],render(){const e=arguments[0];var t=U.get(this.ev,"data.message.attachments",[]),i=[];let s=U.get(this.ev,"by.type");if(U.each(t,(e,t)=>{if(e&&U.includes(e.mimetype,"image")&&e.url){var s=e.url;s.startsWith("https://")||s.startsWith("http://")||s.startsWith("content://")||(e.url=T.FileURL+s),i.push(e)}}),0===i.length)return null;var r=U.map(i,(t,i)=>e("div",{class:"image-attachment image-attachment--"+s},[e("a",{attrs:{href:U.replaceFileUrl(t.thumbnail_url||t.url),target:"_blank"}},[e("img",{class:"image-attachment__img",attrs:{src:U.replaceFileUrl(t.thumbnail_url||t.url)},on:{load:this.onLoad}})])]));return e("div","agent"===s?{class:"message-agent"}:{class:"message-user"},[r])},methods:{onLoad(){this.$emit("loaded")}}},B=i("4260"),L={name:"AudioAttachments",props:["ev"],render(){const e=arguments[0];let t=B.get(this.ev,"by.type");var i=B.get(this.ev,"data.message.attachments",[]),s=[];if(B.each(i,(e,t)=>{e&&B.includes(e.mimetype,"audio")&&s.push(e)}),0===s.length)return null;var r=B.map(s,(i,s)=>e("div",{key:s,class:"audio-attachment audio-attachment--"+t},[e("audio",{class:"audio-attachment__audio",attrs:{controls:!0}},[e("source",{attrs:{src:B.replaceFileUrl(i.url),type:i.mimetype}})])]));return e("div",{class:"message-"+t},[r])}},z=i("4260"),q={name:"FileAttachments",props:["ev"],render(){const e=arguments[0];var t=z.get(this.ev,"by.type","agent"),i=z.get(this.ev,"data.message.attachments",[]),s=[];if(z.each(i,e=>{e&&e.url&&(z.includes(e.mimetype,"video")||z.includes(e.mimetype,"audio")||z.includes(e.mimetype,"image")||"button"===e.type||"quick_replies"===e.type||"form"===e.type||"form_submit"===e.type||s.push(e))}),0===s.length)return null;var r=z.map(s,(i,s)=>e("div",{key:s,class:"file-attachment file-attachment--"+t},[e("a",{class:"file-attachment--link",attrs:{href:z.replaceFileUrl(i.url),target:"_blank"}},[e("span",{class:"file-attachment--download mr-2"}),e("span",{class:"file-attachment--filename"},[i.name])])]));return e("div",{class:"message-"+t},[r])}},Y=i("4260"),R={props:["buttons"],render(){const e=arguments[0];if(0===Y.size(this.buttons))return null;var t=Y.map(this.buttons,(t,i)=>"call_button"===t.type?e("a",{class:"url-button-attachment",attrs:{href:"tel:"+t.phone_number,title:t.title},key:i},[t.title]):"url_button"===t.type?e("a",{class:"url-button-attachment",attrs:{href:t.url,target:"_blank",title:t.title},key:i},[t.title||t.url]):"widget_ask_desktop_notify_button"===t.type?e("a",{class:"url-button-attachment",key:i,attrs:{title:t.title}},[this.$t("allow_notification")||t.title]):"widget_ask_contact_info_button"===t.type?e("a",{class:"url-button-attachment",key:i,attrs:{title:t.title},on:{click:e=>(e.stopPropagation(),this.openSetting(e))}},[this.$t("btn_ask_save_info")||t.title]):null);return e("div",{class:"button-attachments"},[t])}},H=i("4260"),J={props:["ev"],render(){const e=arguments[0];let t=H.get(this.ev,"by.type");if("user"===t)return null;let i=[],s=H.get(this.ev,"data.message.attachments",[]);return H.each(s,(e,t)=>{e&&"button"===H.get(e,"type")&&H.each(H.get(e,"buttons")||[],e=>i.push(e))}),e(R,{attrs:{buttons:i}})}};let N=i("4260");var V={props:["items","selected"],data(){return{search:"",isShow:!1}},render(){const e=arguments[0];let t=N.filter(this.items,e=>{let t=this.search.toLowerCase(),i=e||"";return i.toLowerCase().indexOf(t)>-1}),i=N.map(t,t=>e("li",{class:"custom-select--item-options",on:{click:()=>this.add(t)}},[t])),s=N.map(this.selected,(t,i)=>e("div",{class:"custom-select--selected-item",on:{click:e=>(e.stopPropagation(),e.preventDefault(),(()=>this.remove(i))())}},[t,e("i",{class:"icn-delete delete-tag"})])),r=e("div",{class:"custom-select--wrap-options"},[e("input",D()([{on:{input:e=>{e.target.composing||(this.search=e.target.value)}},attrs:{type:"text",placeholder:"Tìm kiếm"},class:"custom-select--input-search",domProps:{value:this.search}},{directives:[{name:"model",value:this.search,modifiers:{}}]},{on:{click:e=>(e.stopPropagation(),e.preventDefault(),(()=>{this.isShow=!0})())}}])),e("ul",{class:"custom-select--items-options"},[i])]);return this.isShow||(r=null),e("div",{class:"form-control custom-select"},[e("div",{class:"custom-select--wrap-selected",directives:[{name:"clickaway",value:this.clickaway}],on:{click:()=>{this.isShow=!this.isShow}}},[e("div",{class:"custom-select--selected-items"},[s]),r,e("div",{class:"custom-select--icon-dropdown"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("g",{attrs:{opacity:"0.6"}},[e("path",{attrs:{d:"M7 9.5L12 14.5L17 9.5H7Z",fill:"black"}})])])])])])},methods:{clickaway(){this.isShow=!1},add(e){this.$emit("onAddItem",e)},remove(e){this.$emit("onRemoveItem",e)}}};function Q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function X(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(i),!0).forEach((function(t){G(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function G(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let W=i("4260");var Z={props:["form","ev"],data(){return X(X({},s["a"].bind(this,["user"])),{},{rerender:!1,showDropdownListType:!1,formData:[]})},created(){let e=W.get(this.form,"fields")||[];this.formData=W.map(e,e=>{let t=e.is_required||!1;var i=W.parseJSON(e.state)||{};t||(t=i.require||!1);var s=W.getUserAttr(this.user,e.name,i.type||"text");return{name:e.name,items:e.items,value:W.parseJSON(e.answer)||W.parseJSON(e.default_answer)||s,is_required:t,label:e.title,type:e.input_type}})},render(){const e=arguments[0];this.rerender;if(0===W.size(this.formData))return null;let t=this.renderFields(),i=null;return this.form._submitted||(i=e("div",{class:"mt-2"},[e("button",{attrs:{type:"button"},class:"form-attachment--submit-btn",on:{click:this.submit}},[this.$t("btn_submit_form_attachment")])])),e("div",{class:"form-attachment",on:{click:e=>{e.stopPropagation()}}},[this.$t(this.form.title)||this.$t("capture_lead_title"),t,i])},methods:{focus(){if(s["a"].isPreview)return;if(0===W.size(this.formData))return;let e;if(this.isFormFilled()){var t=Object.keys(this.formData),i=t[W.size(t)-1],r=this.formData[i];e=this.$refs["field."+r.name]}else{var a=this.firstUnfilledField();if(!a)return;e=this.$refs["field."+a.name]}e&&e.focus()},firstUnfilledField(){return W.find(this.formData,e=>null==e.value||""===e.value)},isFormFilled(){return!W.find(this.formData,e=>null==e.value||""===e.value)},renderFields(){const e=this.$createElement;if(0===W.size(this.formData))return null;let t=null;return t=W.map(this.formData,(t,i)=>{let s=null;t.answered&&(this.form._submitted=!0);var r=t.error?"input--error":"";if("text"===t.type)s=this.form._submitted?e("div",{class:"form-control--container"},[e("input",D()([{on:{input:e=>{e.target.composing||this.$set(this.formData[i],"value",e.target.value)}},attrs:{disabled:!0,type:"text"},ref:"field."+t.name,class:"form-control "+r,domProps:{value:this.formData[i].value}},{directives:[{name:"model",value:this.formData[i].value,modifiers:{}}]}])),e("i",{class:"form-control--check"})]):e("input",D()([{on:{input:e=>{e.target.composing||this.$set(this.formData[i],"value",e.target.value)}},ref:"field."+t.name,class:"form-control "+r,attrs:{type:"text"},domProps:{value:this.formData[i].value}},{directives:[{name:"model",value:this.formData[i].value,modifiers:{}}]}]));else if("number"===t.type)s=this.form._submitted?e("div",{class:"form-control--container"},[e("input",D()([{on:{input:e=>{e.target.composing||this.$set(this.formData[i],"value",e.target.value)}},attrs:{disabled:!0,type:"number"},ref:"field."+t.name,class:"form-control "+r,domProps:{value:this.formData[i].value}},{directives:[{name:"model",value:this.formData[i].value,modifiers:{}}]}])),e("i",{class:"form-control--check"})]):e("input",D()([{on:{input:e=>{e.target.composing||this.$set(this.formData[i],"value",e.target.value)}},ref:"field."+t.name,class:"form-control "+r,attrs:{type:"number"},domProps:{value:this.formData[i].value}},{directives:[{name:"model",value:this.formData[i].value,modifiers:{}}]}]));else if("boolean"===t.type)s=e("div",{class:"checkbox"},[e("input",{ref:"field."+t.name,attrs:{type:"checkbox",id:"checkbox."+this.ev.id+"."+t.name},on:{change:e=>this.formData[i].value=e.target.checked},domProps:{checked:t.value}}),e("label",{class:"checkbox--label",attrs:{for:"checkbox."+this.ev.id+"."+t.name}},[t.label]),e("div",{class:"checkbox--check"},[e("div")])]);else if("list"===t.type){this.formData[i].value=this.formData[i].value||[];let r=this.formData[i].value,a=W.filter(W.get(t,"items",[]),e=>!this.formData[i].value.includes(e));s=e(V,{attrs:{selected:r,items:a},on:{onAddItem:e=>this.formData[i].value.push(e),onRemoveItem:e=>this.$delete(this.formData[i].value,e)}})}else"datetime"===t.type&&(s=e("input",D()([{on:{input:e=>{e.target.composing||this.$set(this.formData[i],"value",e.target.value)}},class:"form-control "+r,attrs:{type:"date"},domProps:{value:this.formData[i].value}},{directives:[{name:"model",value:this.formData[i].value,modifiers:{}}]}])));let a=t.label;return"fullname"===t.name?a=this.$t("fullname"):"emails"===t.name?a=this.$t("email"):"phones"===t.name&&(a=this.$t("phones")),e("div",[e("p",{class:"label mt-3"},[a,t.is_required?e("span",{class:"ml-1 red"},["*"]):""]),t.error?e("div",{class:"form-control--valid-input--error"},[t.error]):"",s])}),e("div",[t])},async submit(){var e=!1;if(W.map(this.formData,t=>{t.is_required&&(void 0===t.value||""===t.value||0===W.size(t.value)&&Array.isArray(t.value))?(t.error=this.$t("error_empty"),e=!0):t.error="","emails"===t.name&&t.value&&(W.isEmail(t.value)||(t.error=this.$t("error_email_invalid"),e=!0))}),this.rerender=!this.rerender,e)return;let t={};W.map(this.formData,e=>{var i={key:e.name};e.answered=(new Date).getTime(),"number"===e.type&&(i.number=parseInt(e.value),e.answer=W.stringify(i.number)),"datetime"===e.type&&(i.datetime=new Date(e.value).toISOString(),e.answer=W.stringify(i.datetime)),"list"===e.type&&(i.list=e.value,e.answer=W.stringify(i.list)),"text"!==e.type&&"boolean"!==e.type||(i[e.type]=e.value,e.answer=W.stringify(e.value)),W.setUserAttr(t,i)}),s["a"].setUser(t);let i={attachments:[{type:"form_submit",form_submit:{state:'{"user_id":"'+s["a"].user.id+'"}',form_message_id:W.get(this.ev,"id"),fields:this.formData}}]},r=W.convoKeyOfEv(this.ev);s["a"].sendConvoEvent(r,i),this.$emit("submit")}}};let ee=i("4260");var te={props:["ev"],render(){const e=arguments[0];let t=ee.get(this.ev,"by.type");if("user"===t)return;let i=[],s=ee.get(this.ev,"data.message.attachments")||[];ee.each(s,e=>{e&&("form"!==e.type&&"ask_info_form"!==e.type||(e.form._type=e.type,i.push(e.form)))});let r=ee.map(i,(t,i)=>e(Z,{ref:"form",key:i,attrs:{form:t,ev:this.ev},on:{submit:this.onSubmit}}));return e("div",{class:"message-agent"},[r])},methods:{onSubmit(){this.$emit("submit")},focus(){var e=this.$refs.form;e&&e.focus()}}};let ie=i("4260");var se={props:["ev"],render(){const e=arguments[0];let t=[],i=ie.get(this.ev,"data.message.attachments")||[];ie.each(i,e=>{e&&"form_submit"===e.type&&e.form_submit&&t.push(e.form_submit)});let s=ie.map(t,(t,i)=>e("div",{class:"info-message"},[e("span",[this.$t("prechat_form_thanks")])]));return e("div",[s])}},re=i("4260"),ae=i("61a2"),oe={props:["ev"],watch:{ev(e){this.$nextTick(()=>this.bindDrag())}},mounted(){this.bindDrag()},render(){const e=arguments[0];let t=re.get(this.ev,"by.type");if("user"===t)return null;let i=re.get(this.ev,"data.message.attachments",[]),s=re.filter(i,e=>"generic"===re.get(e,"type"));if(0===s.length)return null;var r=re.map(s,(t,i)=>{var s=re.map(t.elements,t=>{let i=t.title?e("div",{class:"generic-attachment--element-title"},[t.title]):null,s=t.subtitle?e("div",{class:"generic-attachment--element-subtitle"},[t.subtitle]):null;return e("div",{class:"generic-attachment--element"},[e("div",[e("img",{class:"generic-attachment--element-img",attrs:{src:re.replaceFileUrl(t.image_url)}})]),i,s,e(R,{attrs:{buttons:t.buttons}})])});return e("div",{class:"generic-attachment-container"},[e("div",{ref:"template_"+i,class:"generic-attachment"},[s])])});return r},methods:{bindDrag(){re.map(this.$refs,(e,t)=>{t.startsWith("template_")&&ae(e,()=>{})})}}},ne=i("4260"),ce={name:"VideoAttachments",props:["ev"],render(){const e=arguments[0];let t=ne.get(this.ev,"by.type");var i=ne.get(this.ev,"data.message.attachments",[]),s=[];if(ne.each(i,(e,t)=>{e&&ne.includes(e.mimetype,"video")&&s.push(e)}),0===s.length)return null;var r=ne.map(s,(i,s)=>e("div",{class:"video-attachment video-attachment--"+t},[e("video",{class:"video-attachment__video",attrs:{src:ne.replaceFileUrl(i.url),width:"100%",height:"",poster:ne.replaceFileUrl(i.thumbnail_url),controls:"controls",preload:"metadata"},on:{click:"this.play()"}})]));return e("div",{class:"message-"+t},[r])}},le=i("0e54"),de=i.n(le),me=i("4260"),ue={name:"TextMessage",props:["ev"],data(){return{sendError:!1}},created(){this.checkSendError()},render(){const e=arguments[0];var t=me.get(this.ev,"data.message.format","plaintext");if("markdown"===t)return this.renderMarkdown();var i=me.get(this.ev,"data.message.text");if(0===me.size(i))return null;let s=me.get(this.ev,"by.type");var r=me.extractText(i).map(t=>"emoji"===t.type?e(v["a"],{attrs:{emojiCode:t.text,byType:s}}):"link"===t.type?e("a",{attrs:{href:t.text,target:"_blank"}},[t.text]):"phone"===t.type?e("a",{attrs:{href:"tel:"+t.text}},[t.text]):"email"===t.type?e("a",{attrs:{href:"mailto:"+t.text}},[t.text]):t.text);return"agent"===s?e("div",[e("div",{class:"message-agent message-text--agent"},[r])]):e("div",{class:"d-flex flex-column align-items-end"},[e("div",{class:"message-user message-text--user "+(this.sendError?"message-text--error":"")},[r]),this.sendError?e("div",{class:"red"},[e("a",{attrs:{src:"javascript:;"},on:{click:this.resendMessage}},[this.$t("error_send_message")])]):null])},methods:{renderMarkdown(){const e=this.$createElement;var t=me.get(this.ev,"data.message.text");if(0===me.size(t))return null;let i=me.get(this.ev,"by.type");return"agent"===i?e("div",{class:"markdown-message message-agent message-text--agent"},[e("div",{domProps:{innerHTML:de()(t)}})]):e("div",{class:"d-flex flex-column align-items-end"},[e("div",{class:"markdown-message message-user message-text--user "+(this.sendError?"message-text--error":"")},[e("div",{domProps:{innerHTML:de()(t)}})]),this.sendError?e("div",{class:"red"},[e("a",{attrs:{src:"javascript:;"},on:{click:this.resendMessage}},[this.$t("error_send_message")])]):null])},async resendMessage(){let e=me.convoKeyOfEv(this.ev);const t={text:me.get(this.ev,"data.message.text"),format:"plaintext"};await s["a"].sendConvoEvent(e,t)},checkSendError(){if(this.ev.id!==me.getMsgField(this.ev,"idempotency"))return void(this.sendError=!1);let e=me.getMs(me.get(this.ev,"created"));(new Date).getTime()-e>6e4?this.sendError=!0:(this.sendError=!1,setTimeout(()=>{this.checkSendError()},6e4))}}},he=i("4260");function ve(e){return e?e<2?"poor":e<4?"average":"great":"poor"}var pe={name:"InfoMessage",props:["ev"],render(){const e=arguments[0];if("conversation_rated"===this.ev.type){var t=he.get(this.ev,"data.conversation.ratings.0",{no_rating:!0,rating:0});return t.no_rating?null:e("div",{class:"info-message"},[this.$t("rated_as")+" "+this.$t(ve(t.rating)).toLowerCase()])}return null}},ge=i("4260"),fe={props:["event"],render(){const e=arguments[0];var t=this.event||{};switch(t.type){case"conversation_joined":break;case"message_sent":return this.renderMessageSent(t);case"conversation_state_updated":case"conversation_rating_requested":case"conversation_rated":return e(pe,{attrs:{ev:t}})}return null},methods:{focus(){this.$refs.formAttachments.focus()},renderAgentAvatar(e){const t=this.$createElement;let r=ge.get(e,"by.type"),a=ge.get(e,"by.display_id",ge.get(e,"by.id"));if("user"===r)return null;var o=ye(e),n=ge.get(s["a"].account,"logo_url")||i("9487");return"system"===a&&"dummy"===r||(n=ge.get(s["a"].agentM[a],"avatar_url")||ge.get(s["a"].account,"logo_url")||i("b55b")),t("div",{class:"message-sender"},[t("img",{class:"message-sender-avatar",attrs:{src:ge.replaceFileUrl(n)}}),t("p",{class:"message-sender-name"},[o])])},renderMessageSent(e){const t=this.$createElement;if(e._thanks)return t("div",{class:"info-message"},[t("span",[ge.get(e,"data.message.text")])]);var i=null;"lead"===e.mode&&(i=this.renderAgentAvatar(e));var s=null;"lead"===e.mode&&(s=t("div",{class:"convo-event-time"},[t(h,{attrs:{time:e.created}})]));let r="user"===ge.get(this.ev,"by.type")?"user-message":"agent-message";return t("div",{class:"convo-event "+r},[s,i,t(ue,{attrs:{ev:e}}),t(K,{attrs:{ev:e}}),t(L,{attrs:{ev:e}}),t(ce,{attrs:{ev:e}}),t(q,{attrs:{ev:e}}),t(J,{attrs:{ev:e}}),t(te,{ref:"formAttachments",attrs:{ev:e},on:{submit:this.onFormSubmit}}),t(se,{attrs:{ev:e}}),t(oe,{attrs:{ev:e}})])},renderUpdateConvo(e){const t=this.$createElement;var i=ge.get(e,"data.conversation.state");return"active"===i||"pending"===i?null:t("div",{class:"message-system"},[this.$t("conversation_state_updated",{state:i})])},onFormSubmit(){this.$emit("formSubmit")}}};function ye(e){let t=ge.get(e,"by.type"),i=ge.get(e,"by.display_id",ge.get(e,"by.id"));return"system"===i||"dummy"===t?"system":"user"===t?ge.getUserDisplayName(s["a"].user):"agent"===t?ge.getAgentDisplayName(s["a"].account,s["a"].agentM[i]):""}function be(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function ke(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?be(Object(i),!0).forEach((function(t){we(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function we(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Oe=i("4260"),_e={props:["convoKey","formMode","preForm","postForm"],data(){return ke(ke({},s["a"].bind(this,["convoEventM"])),{},{isFetching:!1,events:[]})},created(){this.loadConvo()},watch:{convoKey:function(e,t){this.loadConvo()}},render(){const e=arguments[0];if(0===Oe.size(this.events))return e("div",{ref:"body",class:"widget-body--events-container"},[e("div",{class:"widget-body--empty"},[e("div",{class:"widget-body--empty-icon"}),e("div",{class:"widget-body--empty-text"},[this.$t("empty_convo_text")])]),e(a)]);let t=Oe.map(this.events,t=>e(fe,{attrs:{"data-ev-id":t.id,event:t},ref:"event."+t.id,key:t.id,on:{formSubmit:this.onFormSubmit}}));return e("div",{ref:"body",class:"widget-body--events-container",attrs:{"data-convo":this.convoKey}},[e("div",{class:"flex-1"},[t]),e(a)])},methods:{onFormSubmit(){this.$emit("formSubmit")},focus(){var e,t=Oe.orderBy(Oe.map(this.convoEventM[this.convoKey],e=>e),"created","desc");for(let r of t)if("message_sent"===Oe.get(r,"type")&&"user"!==Oe.get(r,"by.type")){e=r;break}"user"===Oe.get(e,"by.type")&&(e=null);let i=Oe.get(e,"data.message.attachments",[]),s=Oe.filter(i,e=>{if(!e)return!1;if("form"!==e.type&&"ask_info_form"!==e.type)return!1;var t=e.form;if(!t)return!1;var i=Oe.parseJSON(t.state)||{};return!(!i.require_finished&&"ask_info_form"!==e.type)&&!t._submitted});Oe.size(s)>0&&this.$refs["event."+e.id].focus()},onEvents(e){var t=Oe.map(s["a"].convoEventM[this.convoKey],e=>e);let i=this.isBottom();var r=!1;this.events=[],Oe.map(t,e=>{this.events=je(this.events,e)}),Oe.get(e,"by.id")===s["a"].user.id&&"message_sent"===Oe.get(e,"type")&&(r=!0),(r||i)&&this.scrollToBottom()},loadConvo(){this.events=[],this.lastContentOffsetY=0,s["a"].onConvoEvent(this,e=>this.onEvents(e)),this.onEvents();let e=Oe.get(s["a"].accountSetting,"greeting",{}),t=e.agent_id,i={id:Oe.randomString(36),mode:"lead",created:(new Date).getTime(),type:"message_sent",by:{id:t,type:"agent"},data:{message:{text:e.message,format:"plaintext"}}};if(this.preForm&&(this.convoKey?this.postForm&&this.events.unshift(i):this.events=[i]),this.postForm){let e="";"offline"===this.formMode&&(e=this.$t("offline_form_thanks")),"prechat"===this.formMode&&(e=this.$t("prechat_form_thanks")),this.events.push({_thanks:!0,id:Oe.randomString(36),created:(new Date).getTime()+5e3,type:"message_sent",by:{id:t,type:"agent"},data:{message:{text:e,format:"plaintext"}}})}this.scrollToBottom(),setTimeout(()=>this.scrollToBottom(),300)},isBottom(){let e=this.$refs.body;return!!e&&e.scrollHeight<e.scrollTop+e.offsetHeight+50},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.body;e&&(e.scrollTop=e.scrollHeight)})},async loadMore(){if(!this.loadingMore){this.loadingMore=!0;var e=Oe.get(this.props.convo,"_key"),t=await s["a"].fetchOlder(e);t&&console.log("err",t),this.loadingMore=!1}},onScroll(e){var t=e.nativeEvent,i=Oe.get(t,"contentOffset.y",0);if(this.lastContentOffsetY=i,!this.loadingMore){var s=Oe.get(t,"contentSize.height",0);s-=Oe.get(t,"layoutMeasurement.height",0);var r=Oe.shouldLoadMore(i,s,this.lastContentOffsetY);return r?this.loadMore():void 0}}}};function je(e,t){if(!Oe.get(t,"id"))return e;if(0===Oe.size(e))return[t];e||(e=[]),t.created=Oe.getMs(t.created);var i=Oe.getMsgField(t,"idempotency");if(i!==t.id){var s=Oe.findIndex(e,e=>e.id===i);-1!==s&&(e.splice(s,1),Oe.convertUpdatedOrDeletedMessageEvent(e,s-1))}else{s=e.findIndex(e=>{if("message_sent"!==e.type)return!1;var t=Oe.getMsgField(e,"idempotency");return e.id!==t&&t===i});if(-1!==s)return e}s=e.findIndex(e=>e.id===t.id);-1!==s&&(e.splice(s,1),Oe.convertUpdatedOrDeletedMessageEvent(e,s-1));for(var r=0;r<e.length;r++){var a=e[r];if(Oe.getMs(t.created)<=Oe.getMs(a.created))return e.splice(r,0,t),Oe.convertUpdatedOrDeletedMessageEvent(e,r),e}return e.push(t),Oe.convertUpdatedOrDeletedMessageEvent(e,e.length-1),e}function Pe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Ee(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(i),!0).forEach((function(t){$e(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Pe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function $e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let De=i("4260");var Me={name:"Typing",props:["convoKey"],data(){return Ee(Ee({},s["a"].bind(this,["agentM","user"])),{},{isShow:!1,timer:null,ev:{}})},mounted(){s["a"].onConvoEvent(this,e=>{"conversation_typing"===De.get(e,"type")&&De.convoKeyOfEv(e)===this.convoKey&&De.get(e,"by.id")!==this.user.id&&(this.ev=e,this.isShow=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=null,this.isShow=!1},1200))})},render(){const e=arguments[0];var t=this.isShow?"":"typing--hidden";let i=De.get(this.ev,"by.display_id",De.get(this.ev,"by.id")),r=De.getAgentDisplayName(s["a"].account,De.get(this.agentM,i));return e("div",{class:"typing "+t},[r," ",this.$t("typing")])}};function xe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Se(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(i),!0).forEach((function(t){Ce(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ae=i("61a2"),Fe=i("4260"),Ie={name:"QuickReplies",props:["convoKey"],data(){return Se(Se({},s["a"].bind(this,["agentM","user","convoEventM"])),{},{events:[]})},mounted(){s["a"].onConvoEvent(this,e=>{var t=Fe.convoKeyOfEv(e);t===this.convoKey&&this.$forceUpdate()}),Ae(this.$refs.quickreplies,()=>{})},render(){const e=arguments[0];var t,i=Fe.orderBy(Fe.map(this.convoEventM[this.convoKey],e=>e),"created","desc");for(let o of i)if("message_sent"===Fe.get(o,"type")){t=o;break}"user"===Fe.get(t,"by.type")&&(t=null);var s=[];Fe.map(Fe.get(t,"data.message.attachments",[]),e=>{e&&"quick_replies"===e.type&&(s=Fe.map(e.quick_replies,e=>e.title||""))}),s=Fe.filter(s,e=>!!e);let r=s.length>0?"":"quick-replies-container--hidden",a=Fe.map(s,i=>e("div",{class:"quick-replies--item",on:{click:()=>this.selectReply(t,i)}},[i]));return e("div",{class:"quick-replies-container "+r},[e("div",{ref:"quickreplies",class:"quick-replies"},[a])])},methods:{selectReply(e,t){this.$emit("select",t)}}};function Ue(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Te(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(i),!0).forEach((function(t){Ke(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ue(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ke(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Be=i("4260"),Le=i("f4c1");const ze=400,qe=500,Ye=0;var Re={name:"Rating",props:["convoKey"],data(){return Te(Te({hide:!0},s["a"].bind(this,["convoEventM"])),{},{ratingHeight:0,overlayOpacity:.3,comment:""})},watch:{show(e){e&&this.open(),this.close()}},mounted(){s["a"].onConvoEvent(this,e=>{var t=Be.convoKeyOfEv(e);t===this.convoKey&&this.shoudDisplay()&&this.open()}),this.mouseUp=e=>this.onMouseUp(e),this.mouseMove=e=>this.onMouseMove(e),this.mouseDown=e=>this.onMouseDown(e);var e=this.$refs.handle;e.addEventListener("mousedown",this.mouseDown,0),e.addEventListener("touchstart",this.mouseDown,0),window.addEventListener("mouseup",this.mouseUp,0),window.addEventListener("touchend",this.mouseUp,0),window.addEventListener("mousemove",this.mouseMove,0),window.addEventListener("touchmove",this.mouseMove,0),this.animation=new Le({maxY:ze,minY:Ye,duration:150}),this.close(),this.shoudDisplay()&&this.open()},unmounted(){var e=this.$refs.handle;e.removeEventListener("mousedown",this.mouseDown,0),e.removeEventListener("touchstart",this.mouseDown,0),window.removeEventListener("mouseup",this.mouseUp,0),window.removeEventListener("touchend",this.mouseUp,0),window.removeEventListener("mousemove",this.mouseMove,0),window.removeEventListener("touchmove",this.mouseMove,0)},render(){const e=arguments[0];let t=this.hide?"d-none":"";return e("div",{class:t},[e("div",{class:"rating--overlay",style:`opacity: ${.5*this.overlayOpacity} !important;`}),e("div",{class:"rating",ref:"rating",style:`color:red; height: ${this.ratingHeight}px !important;`},[e("div",{class:"rating--handle",ref:"handle"},[e("div",{class:"rating--thumb"})]),e("div",{class:"rating--content"},[e("div",{class:"rating--heading"},[this.$t("rating_title"),e("div",{class:"rating--close-btn",on:{click:this.onCloseRating}})]),e("div",{class:"rating--description"},[this.$t("rating_description")]),e("textarea",{ref:"comment",attrs:{type:"text"},class:"rating--comment",on:{change:this.onCommentChange}}),e("div",{class:"rating-faces-container"},[e("div",{class:"rating-face-container",on:{click:this.onRatingPoor}},[e("img",{attrs:{src:i("bc27")}}),e("p",{class:"rating-face--text"},[this.$t("poor")])]),e("div",{class:"rating-face-container",on:{click:this.onRatingAverage}},[e("img",{attrs:{src:i("c94d")}}),e("p",{class:"rating-face--text"},[this.$t("average")])]),e("div",{class:"rating-face-container",on:{click:this.onRatingGreat}},[e("img",{attrs:{src:i("9ffa")}}),e("p",{class:"rating-face--text"},[this.$t("great")])])]),e("div",{class:"rating-no-thanks",on:{click:this.onCloseRating}},[this.$t("no_thanks")])])])])},methods:{onCommentChange(e){this.comment=e.target.value},shoudDisplay(){var e,t,i,r=this.convoEventM[this.convoKey];if(Be.map(r,r=>{"conversation_state_updated"===Be.get(r,"type")&&"ended"===Be.get(r,"data.conversation.state")&&(i=r),"conversation_rating_requested"===Be.get(r,"type")&&(e=r),"conversation_rated"===Be.get(r,"type")&&Be.get(r,"by.id")===s["a"].user.id&&(t=r)}),t)return!1;var a=s["a"].accountSetting.auto_request_rating&&i;return e||a},onCloseRating(){this.$emit("rate",{no_rating:!0,comment:this.comment}),this.close()},onRatingPoor(){this.$emit("rate",{rating:1,comment:this.comment}),this.close()},onRatingAverage(){this.$emit("rate",{rating:3,comment:this.comment}),this.close()},onRatingGreat(){this.$emit("rate",{rating:5,comment:this.comment}),this.close()},open(){if(this.hide){this.hide=!1,setTimeout(()=>{this.$refs.comment&&this.$refs.comment.focus()},400),this.$refs.comment.value="";var e=this.$refs.rating.currentStyle||window.getComputedStyle(this.$refs.rating),t=parseFloat(e.height);this.animation.play(-20,t,e=>{this.ratingHeight=e,this.overlayOpacity=Math.min(1,(e-Ye)/(qe-Ye))})}},close(){if(!this.hide){var e=this.$refs.rating.currentStyle||window.getComputedStyle(this.$refs.rating),t=parseFloat(e.height);this.animation.play(20,t,e=>{this.ratingHeight=e,this.overlayOpacity=Math.min(1,(e-Ye)/(qe-Ye)),e<Ye+10&&(this.hide||(this.hide=!0))})}},onMouseDown(e){this.mousePushed=!0,this.animation.stop(),e.preventDefault(),e.touches&&e.touches[0]&&(e=e.touches[0]),this.mousePushedDy=e.pageY-window.pageYOffset-this.$refs.rating.getBoundingClientRect().y},onMouseUp(e){if(this.mousePushed){e.touches&&e.touches[0]&&(e=e.touches[0]),this.mousePushed=!1;var t=this.$refs.rating.currentStyle||window.getComputedStyle(this.$refs.rating),i=parseFloat(t.height);this.animation.play(this.mouseVelocity,i,e=>{this.ratingHeight=e,this.overlayOpacity=Math.min(1,(e-Ye)/(qe-Ye)),e<Ye+10&&(this.hide||(this.hide=!0,this.$emit("rate",{no_rating:!0})))})}},onMouseMove(e){if(this.mousePushed){e.touches&&e.touches[0]&&(e=e.touches[0]);var t=e.pageY;this.mouseVelocity=t-this.lastMouseY,this.lastMouseY=t,t-=this.mousePushedDy;var i=1e4,s=this.$refs.rating.getBoundingClientRect().bottom-t;if(s>ze){var r=i/(qe-ze)-ze;s=qe-i/(s+r)}this.ratingHeight=s,this.overlayOpacity=Math.min(1,(s-Ye)/(qe-Ye))}}}};function He(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Je(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?He(Object(i),!0).forEach((function(t){Ne(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):He(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ne(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ve=i("337f").getParser(window.navigator.userAgent).parsedResult;var Qe=i("4260"),Xe={name:"Convo",props:["convoKey","isShow","forceMode"],data(){return Je(Je({},s["a"].bind(this,["user","accountSetting","convoM","convoEventM","convoIdM"])),{},{mode:"",cvkey:"",form:{},formData:{},selectedGroupId:"",emptyEvents:[]})},watch:{isShow(e){e&&"mobile"===!Ve.platform.type&&this.focusInput(),e&&"mobile"===Ve.platform.type&&this.blur()},convoKey(e){this.cvkey=this.convoKey,this.display({mode:this.forceMode,cvkey:this.cvkey})},convoIdM(e){s["a"].setLastview("chat",{convoKey:this.cvkey,convoId:this.convoIdM[this.cvkey]||"",forceMode:this.mode})},accountSetting(e){this.init()}},created(){this.init(),s["a"].onConvoEvent(this,e=>{if(!this.isShow)return;if(Qe.convoKeyOfEv(e)!==this.cvkey)return;s["a"].seenConvo(this.cvkey);let t="ended"===Qe.get(s["a"].lookupConvo(this.cvkey),"state");return t?this.display({mode:"viewonly"}):void 0})},render(){const e=arguments[0];var t=null;t="form"===this.mode||"offline"===this.mode||"prechat"===this.mode?this.renderForm():"viewonly"===this.mode?this.renderViewOnly():this.renderChat();let i="widget-container ",s=Qe.get(this.accountSetting,"desktop_button.position")||"right";return"mobile"===Ve.platform.type&&(s=Qe.get(this.accountSetting,"mobile_button.position")||s),i+=" widget-container--"+s,i+=this.isShow?"":" widget-container--hide",e("div",{class:i},[this.renderHeader(),t])},methods:{init(){this.isShow&&s["a"].seenConvo(this.convoKey),this.cvkey=this.convoKey;var e=this.forceMode;if(Qe.get(s["a"],"accountSetting.prechat_form.enabled")&&(this.form=this.accountSetting.prechat_form),"offline"===this.forceMode)this.form=this.accountSetting.offline_form;else{let e=Qe.get(s["a"],"accountSetting.offline_form.enabled");!Qe.get(s["a"].accountSetting,"is_online")&&e&&(this.form=this.accountSetting.offline_form)}"offline"!==this.forceMode&&"prechat"!==this.forceMode||(e="form"),""!==e&&"form"!==e&&"viewonly"!==e&&(e=""),this.display({mode:e,cvkey:this.cvkey})},blur(){if(!s["a"].isPreview){var e=this.$refs.msgInput;e&&(this.$nextTick(()=>e.blur()),setTimeout(()=>e.blur(),300))}},focusInput(){if(!s["a"].isPreview){var e=this.$refs.msgInput;e&&(this.$nextTick(()=>e.focus()),setTimeout(()=>e.focus(),300))}},onRate(e){let t=this.cvkey;t&&(s["a"].sendConvoEventData(t,"conversation_rated",{conversation:{ratings:[e]}}),this.focusInput(),s["a"].sendEventToThirdParty("SUBIZ Chat","Sent","User"))},sendMessage(e){let t=this.cvkey,i=e.text;if(!t){const r=s["a"].startConvo({group_id:this.selectedGroupId,message:i});return t=r._key,s["a"].sendConvoEvent(t,e),this.display({mode:"chat",cvkey:r._key})}s["a"].sendConvoEvent(t,e),s["a"].sendEventToThirdParty("SUBIZ Chat","Sent","User")},renderViewOnly(){const e=this.$createElement;return e("div",{class:"widget-body"},[e("div",{class:"widget-body--content",on:{click:this.onContainerClick}},[e(_e,{ref:"events",attrs:{convoKey:this.cvkey},on:{formSubmit:this.onEventFormSubmit}}),e(Me,{attrs:{convoKey:this.cvkey}}),e(Ie,{attrs:{convoKey:this.cvkey},on:{select:this.chooseQuickReply}})]),e(Re,{attrs:{convoKey:this.cvkey},on:{rate:this.onRate}}),e("div",{class:"message-input message-input--preform"},[e("button",{class:"btn--start-convo",on:{click:this.onStartConvoClick}},[this.$t("offline_preform_btn")])])])},renderChat(){const e=this.$createElement;return e("div",{class:"widget-body"},[e("div",{class:"widget-body--content",on:{click:this.onContainerClick}},[e(_e,{ref:"events",attrs:{convoKey:this.cvkey},on:{formSubmit:this.onEventFormSubmit}}),e(Me,{attrs:{convoKey:this.cvkey}}),e(Ie,{attrs:{convoKey:this.cvkey},on:{select:this.chooseQuickReply}})]),e(Re,{attrs:{convoKey:this.cvkey},on:{rate:this.onRate}}),e(I,{ref:"msgInput",attrs:{convoKey:this.cvkey},on:{send:this.sendMessage}})])},renderHeader(){const e=this.$createElement;let t="collapsed";return 0===Qe.size(this.convoEventM[this.cvkey])&&(t="expanded"),"form"!==this.mode&&"offline"!==this.mode&&"prechat"!==this.mode||(t="collapsed"),e("div",{class:"widget-header widget-header--convo-"+t},[e(b,{attrs:{convoKey:this.convoKey,agentsJoined:We(this.cvkey),mode:t},on:{close:()=>this.$emit("close"),gotoList:()=>this.$emit("go",{view:"list"})}})])},display(e){if(void 0!==e.mode&&(this.mode=e.mode),void 0!==e.cvkey&&(this.cvkey=e.cvkey),"form"===e.mode&&(this.formData=this.fillForm(this.form)),!e.mode){if(this.cvkey){var t=s["a"].lookupConvo(this.cvkey)||{};let e=Ge(this.cvkey);return e?"ended"===t.state?this.display({mode:"viewonly",cvkey:this.cvkey}):this.display({mode:"chat",cvkey:this.cvkey}):this.isFormRequired()?this.display({mode:"viewonly",cvkey:this.cvkey}):this.display({mode:"chat",cvkey:this.cvkey})}return this.isFormRequired()?this.display({mode:"form"}):this.display({mode:"chat"})}s["a"].setLastview("chat",{convoKey:this.cvkey,convoId:s["a"].convoIdM[this.cvkey]||"",forceMode:this.mode}),this.$nextTick(()=>{this.$refs.events&&this.$refs.events.focus(),this.focusInput()})},async onStartConvoClick(){await s["a"].fetchUserSetting();var e=s["a"].lookupConvo(this.cvkey)||{};return"ended"===e.state?(this.cvkey="",this.isFormRequired()?this.display({mode:"form"}):this.display({mode:"chat",cvkey:""})):this.display({mode:"form"})},onEventFormSubmit(){this.focusInput()},chooseQuickReply(e){this.$refs.msgInput.submitMessage(e)},onContainerClick(){var e=window.getSelection();e.toString().length>0||"mobile"===!Ve.platform.type&&this.focusInput()},renderForm(){const e=this.$createElement;let t=this.$t("prechat_form_btn");"offline"===this.mode&&(t=this.$t("offline_form_btn"));let i=null;return this.form.title&&(i=e("p",[this.form.title])),e("div",{class:"widget-body"},[e("div",{class:"widget-body--content flex-grow-1 pl-3 pr-3 d-flex flex-column"},[e("div",{class:"flex-grow-1"},[e("div",{class:"form mt-3 pl-3 pr-3 pt-3 pb-3 d-flex flex-column"},[i,this.renderFields(),e("button",{class:"btn--start-convo mt-3",on:{click:this.submitInfoForm}},[t])])]),e(a)]),e(I,{attrs:{disabled:!0}})])},fillForm(e){if(0===Qe.size(e))return[];this.selectedGroupId="";var t={};return Qe.each(e.fields,e=>{var i=Object.assign({},e);i.value=Qe.getUserAttr(this.user,e.key,e.type),"boolean"!==e.type||i.value||(i.value=!1),"datetime"===e.type&&i.value&&(i.value=new Date(t.value).toLocaleDateString("en-CA")),"list"===e.type&&(i.list=e.list),t["attr:"+e.key]=i}),this.cvkey||(void 0!==e.group_required&&e.groups&&e.groups.length>0&&(t["group"]={key:"group",is_required:!!e.group_required,label:e.group_label,type:"group",list:Qe.map(e.groups,e=>({value:e.id,label:e.name}))}),void 0!==e.question_required&&(t["question"]={key:"question",is_required:!!e.question_required,label:e.question_label,type:"text"})),t},firstUnfilledField(){return Qe.find(this.formData,e=>null==e.value||""===e.value)},isFormRequired(){let e=this.fillForm(this.form);return this.cvkey&&(delete e.group,delete e.question),!!Qe.find(e,e=>null==e.value||""===e.value)},submitInfoForm(){var e=!1;if(Qe.map(this.formData,(t,i)=>{t.is_required&&(void 0===t.value||""===t.value||0===Qe.size(t.value)&&Array.isArray(t.value))?(t.error=this.$t("error_empty"),e=!0):t.error="","emails"===i.substr(5)&&!Qe.isEmail(t.value)&&t.is_required&&(t.error=this.$t("error_email_invalid"),e=!0)}),this.$forceUpdate(),e)return;let t=Qe.cloneDeep(this.user);Qe.map(this.formData,(e,i)=>{if(i.startsWith("attr:")){var s={key:i.substr(5)};"number"===e.type&&(s.number=parseInt(e.value)),"datetime"===e.type&&(s.datetime=new Date(e.value).toISOString()),"list"===e.type&&(s.list=e.value),"text"!==e.type&&"boolean"!==e.type||(s[e.type]=e.value),Qe.setUserAttr(t,s)}}),s["a"].setUser(t);var i=Qe.get(this.formData,"group.value","");i&&(this.selectedGroupId=i);let r={text:Qe.get(this.formData,"question.value"),format:"plaintext"},a={group_id:i,message:r.text};if(!this.cvkey){if(a.message){const e=s["a"].startConvo(a);return s["a"].sendConvoEvent(e._key,r),this.display({mode:"chat",cvkey:e._key,events:["thanks"]})}return this.display({mode:"chat",cvkey:"",events:["thanks"]})}return r.text&&s["a"].sendConvoEvent(this.cvkey,r),this.display({mode:"chat",cvkey:this.cvkey,events:["thanks"]})},renderFields(){const e=this.$createElement;if(0===Qe.size(this.formData))return null;let t=!0,i=Qe.map(this.formData,(i,s)=>{let r=null;var a=i.error?"input--error":"";if("text"===i.type)r="question"===s?e("textarea",D()([{on:{input:e=>{e.target.composing||this.$set(i,"value",e.target.value)}},class:"form-control",ref:"field."+s,attrs:{row:"4"},domProps:{value:i.value}},{directives:[{name:"model",value:i.value,modifiers:{}}]}])):e("input",D()([{on:{input:e=>{e.target.composing||this.$set(i,"value",e.target.value)}},ref:"field."+s,class:"form-control "+a,attrs:{type:"text"},domProps:{value:i.value}},{directives:[{name:"model",value:i.value,modifiers:{}}]}]));else if("number"===i.type)r=e("input",D()([{on:{input:e=>{e.target.composing||this.$set(i,"value",e.target.value)}},class:"form-control "+a,attrs:{type:"number"},domProps:{value:i.value}},{directives:[{name:"model",value:i.value,modifiers:{}}]}]));else if("boolean"===i.type)r=e("div",{class:"checkbox"},[e("input",{ref:"field."+s,attrs:{type:"checkbox",id:"form-checkbox"+s},on:{change:e=>i.value=e.target.checked},domProps:{checked:i.value}}),e("label",{class:"checkbox--label",attrs:{for:"form-checkbox"+s}},[i.label]),e("div",{class:"checkbox--check"},[e("div")])]);else if("group"===i.type)r=Qe.map(i.list,t=>e("div",{class:"radio"},[e("input",D()([{on:{change:e=>{this.$set(i,"value",t.value)}},attrs:{type:"radio",id:"form-radio"+s+t.value},domProps:{checked:this._q(i.value,t.value)}},{directives:[{name:"model",value:i.value,modifiers:{}}]}])),e("label",{class:"radio--label",attrs:{for:"form-radio"+s+t.value,value:t.value}},[t.label]),e("div",{class:"radio--check"},[e("div",{class:"inside"})])]));else if("list"===i.type){Array.isArray(i.value)||(this.formData[s].value=this.formData[s].value||[]);let t=this.formData[s].value,a=Qe.filter(Qe.get(i,"list",[]),e=>!this.formData[s].value.includes(e));r=e(V,{attrs:{selected:t,items:a},on:{onAddItem:e=>this.formData[s].value.push(e),onRemoveItem:e=>this.$delete(this.formData[s].value,e)}})}else"datetime"===i.type&&(r=e("input",D()([{on:{input:e=>{e.target.composing||this.$set(i,"value",e.target.value)}},ref:"field."+s,class:"form-control "+a,attrs:{type:"date"},domProps:{value:i.value}},{directives:[{name:"model",value:i.value,modifiers:{}}]}])));let o=i.label;"fullname"===i.key?o=this.$t("fullname"):"emails"===i.key?o=this.$t("email"):"phones"===i.key&&(o=this.$t("phones"));let n="mt-3";return t&&(n=""),t=!1,e("div",{class:n},[e("p",{class:"label label__no_top"},[o,i.is_required?e("span",{class:"ml-1 red"},["*"]):""]),i.error?e("div",{class:"form-control--valid-input--error"},[i.error]):"",r])});return e("div",[i])}}};function Ge(e){var t=s["a"].lookupConvo(e)||{};let i=Qe.find(t.members,e=>e.id===s["a"].user.id&&"active"===e.membership);if(i)return!0;var r=s["a"].convoEventM[e]||{};let a=Qe.find(r,e=>Qe.get(e,"by.id")===s["a"].user.id&&"messeage_sent"===e.type);return a}function We(e){var t=s["a"].lookupConvo(e)||{};let i=Qe.filter(t.members,e=>"agent"===e.type&&"active"===e.membership);return i}function Ze(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function et(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(i),!0).forEach((function(t){tt(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ze(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function tt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var it=i("4260");t["default"]={name:"widget",props:["convoKey","view","isShow","forceMode"],data(){return et({},s["a"].bind(this,["convoM"]))},render(){const e=arguments[0];return"list"===this.view&&it.size(this.convoM)>0?e(E,{attrs:{isShow:this.isShow},on:{go:this.goToConvo,close:()=>this.$emit("close")}}):e(Xe,{attrs:{isShow:this.isShow,convoKey:this.convoKey,forceMode:this.forceMode},on:{close:()=>this.$emit("close"),go:this.goToList}})},methods:{goToList(){this.$emit("go",{view:"list"})},goToConvo(e){this.$emit("go",{view:"chat",convoKey:e})}}}},f4c1:function(e,t){function i(e,t,i,r){if(s(e,t))return e;var a=t-e,o=a/r,n=e+o*i;return(e<t&&n>t||t<e&&n<t)&&(n=t),n}function s(e,t){return Math.abs(e-t)<=.001}e.exports=class{constructor(e){this.duration=e.duration||100,this.breakingV=e.breakingV||7,this.maxY=e.maxY||500,this.minY=e.minY||0}play(e,t,i){var s;this.stop();var r=a=>{a||(a=(new Date).getTime());var o=a-s,[n,c]=this.calcY(e,t,o);if(i(n),c)return this.stop();this.animationframe=window.requestAnimationFrame(r)};this.animationframe=window.requestAnimationFrame(e=>{s=e||(new Date).getTime(),r(s)})}calcY(e,t,r){var a;a=t>this.maxY?this.maxY:t<this.minY?this.minY:Math.abs(e)<this.breakingV?Math.abs(this.maxY-t)<Math.abs(this.minY-t)?this.maxY:this.minY:e<0?this.maxY:this.minY;var o=i(t,a,r,this.duration);return[o,s(o,a)]}stop(){window.cancelAnimationFrame(this.animationframe)}}}}]);
//# sourceMappingURL=widget.4f86cacd.js.map